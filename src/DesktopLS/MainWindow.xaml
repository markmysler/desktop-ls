<Window x:Class="DesktopLS.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="DesktopLS"
        Width="700" Height="52"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="True"
        ResizeMode="NoResize"
        WindowStartupLocation="Manual"
        Left="0" Top="0">

    <Border Background="{StaticResource BackgroundBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="0,0,0,1"
            CornerRadius="0,0,8,8"
            Padding="8,4">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Navigation Buttons -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,8,0">
                <Button Content="&#x22EE;" Style="{StaticResource ToolbarButton}"
                        x:Name="SettingsButton" ToolTip="Settings"
                        FontSize="16" Width="32"/>
                <Button Content="&#x2190;" Style="{StaticResource ToolbarButton}"
                        Command="{Binding GoBackCommand}" ToolTip="Back (Alt+Left)"
                        FontSize="16" Width="32"/>
                <Button Content="&#x2192;" Style="{StaticResource ToolbarButton}"
                        Command="{Binding GoForwardCommand}" ToolTip="Forward (Alt+Right)"
                        FontSize="16" Width="32"/>
                <Button Content="&#x2191;" Style="{StaticResource ToolbarButton}"
                        Command="{Binding GoUpCommand}" ToolTip="Up (Alt+Up)"
                        FontSize="16" Width="32"/>
                <Button Content="&#x21BB;" Style="{StaticResource ToolbarButton}"
                        Command="{Binding RefreshCommand}" ToolTip="Refresh (F5)"
                        FontSize="16" Width="32"/>
            </StackPanel>

            <!-- Settings Popup -->
            <Popup x:Name="SettingsPopup"
                   Grid.Column="0"
                   PlacementTarget="{Binding ElementName=SettingsButton}"
                   Placement="Bottom"
                   StaysOpen="False">
                <Border Background="{StaticResource SurfaceBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1" CornerRadius="4"
                        Padding="12">
                    <StackPanel Orientation="Vertical" Width="220">
                        <CheckBox Content="Run on startup"
                                  IsChecked="{Binding StartupEnabled, Mode=TwoWay}"
                                  Margin="0,0,0,8"
                                  Foreground="{StaticResource TextBrush}"/>
                        <CheckBox Content="Hide when window maximized"
                                  IsChecked="{Binding HideOnMaximized, Mode=TwoWay}"
                                  Foreground="{StaticResource TextBrush}"/>
                    </StackPanel>
                </Border>
            </Popup>

            <!-- Path Bar with Autocomplete -->
            <Grid Grid.Column="1" Margin="0,0,8,0">
                <TextBox x:Name="PathBox"
                         Text="{Binding PathText, UpdateSourceTrigger=PropertyChanged}"
                         Foreground="{StaticResource TextBrush}"
                         Background="{StaticResource SurfaceBrush}"
                         BorderBrush="{StaticResource BorderBrush}"
                         CaretBrush="White"
                         FontFamily="Cascadia Code, Consolas, Courier New"
                         FontSize="13"
                         VerticalContentAlignment="Center"
                         Padding="8,4"
                         KeyDown="PathBox_KeyDown"/>

                <Popup IsOpen="{Binding IsAutocompleteOpen}"
                       PlacementTarget="{Binding ElementName=PathBox}"
                       Placement="Bottom"
                       StaysOpen="False"
                       Width="{Binding ActualWidth, ElementName=PathBox}">
                    <Border Background="{StaticResource SurfaceBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="1" CornerRadius="0,0,4,4"
                            MaxHeight="300">
                        <ListBox x:Name="SuggestionsList"
                                 ItemsSource="{Binding Suggestions}"
                                 Background="Transparent"
                                 Foreground="{StaticResource TextBrush}"
                                 BorderThickness="0"
                                 Focusable="True"
                                 MouseLeftButtonUp="SuggestionsList_MouseLeftButtonUp"
                                 MouseDoubleClick="SuggestionsList_MouseDoubleClick"
                                 KeyDown="SuggestionsList_KeyDown">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Padding" Value="8,4"/>
                                    <Setter Property="FontFamily" Value="Cascadia Code, Consolas"/>
                                    <Setter Property="FontSize" Value="12"/>
                                </Style>
                            </ListBox.ItemContainerStyle>
                        </ListBox>
                    </Border>
                </Popup>
            </Grid>

            <!-- Close Button -->
            <Button Grid.Column="2" Content="&#x2715;" Style="{StaticResource ToolbarButton}"
                    Click="CloseButton_Click"
                    FontSize="14" Width="28" ToolTip="Close"/>
        </Grid>
    </Border>
</Window>
